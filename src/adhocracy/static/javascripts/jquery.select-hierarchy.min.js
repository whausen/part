(function(b){b.fn.selectHierarchy=function(f){for(var f=b.extend({separator:" > ",hideOriginal:!0,placeholder:"------",include_empty_options:!0,add_empty_default:!1},f),g=b(this),j=1,k=g.find("option").map(function(){var a=b(this).val();if(f.include_empty_options||a){var d=b(this).text(),c=d.split(f.separator),e=c.length;e>j&&(j=e);return{label:d,short_label:c[e-1],value:a,depth:e,children:[],header:b(this).data("header")}}}),l=[],i=1;i<=j;i++)b.each(k,function(){var a=this;a.depth==i&&(1===i&&l.push(this),
b.each(k,function(){this.depth==i+1&&this.label.match("^"+a.label)==a.label&&a.children.push(this)}))});var m=g.children("option:selected").text();f.hideOriginal&&g.hide();g.wrap('<span class="drilldown-wrapper" />');var h=b("<select>").addClass("drilldown-1");g.after(h);f.add_empty_default&&h.add('<option value="">'+f.placeholder+"</option>");h.data("depth",1);b.each(l,function(){var a=b("<option>");a.val(this.value);a.text(this.short_label);a.data("node",this);h.append(a)});var n=function(){var a=
b(this),d=a.find("option:selected").data("node");a.val()?g.val(a.val()):1<a.data("depth")?g.val(a.prev().val()):g.val("");a.nextAll("select").remove();a.nextAll(".select_header").remove();if(d&&0<d.children.length){var c=b("<select>");a.after(c);f.add_empty_default&&h.add('<option value="">'+f.placeholder+"</option>");c.addClass("drilldown-"+(d.depth+1));c.data("depth",d.depth+1);b.each(d.children,function(){var a=b("<option>");a.val(this.value);a.text(this.short_label);a.data("node",this);c.append(a)});
c.change(n);c.children(":first").attr("selected","selected");c.trigger("change");new_header=b("<div>").addClass("select_header").text(d.header);a.after(new_header)}};h.change(n);var o=function(a,d){var c=b(".drilldown-"+d);c.children("option").each(function(){var e=b(this).text();e===a?b(this).attr("selected","selected"):(e+=f.separator,a.substr(0,e.length)==e&&(b(this).attr("selected","selected"),c.trigger("change"),o(a.substr(e.length,a.length),d+1)))})};m?o(m,1):(h.children(":first").attr("selected",
"selected"),h.trigger("change"))}})(jQuery);
